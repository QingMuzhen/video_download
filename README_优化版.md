# 视频爬虫工具 v4.0 - 优化版

## 🎯 项目简介

这是一个功能强大的视频爬虫工具，支持智能资源检测、多种下载方式、任务队列管理等功能。提供GUI和Web两种界面，当GUI启动失败时会自动跳转到Web界面。

## ✨ 主要特性

### 核心功能
- **智能资源检测** - 自动识别页面中的视频、图片、音频、文档等多种资源
- **多种下载方式** - 支持直接下载、流式下载、分段下载、M3U8流媒体下载等
- **任务队列管理** - 支持批量下载、暂停、继续、重试等操作
- **分类下载** - 支持全部下载、单类下载、单个文件下载
- **断点续传** - 支持大文件断点续传
- **错误容错** - GUI启动失败自动跳转Web界面

### 界面特性
- **GUI界面** - 基于Tkinter的桌面应用，功能齐全
- **Web界面** - 基于Flask的Web应用，青绿色主题，美观易用
- **双界面切换** - GUI出错自动启动Web界面

### 下载增强
- **多种下载策略** - 根据文件类型和大小自动选择最佳下载方式
- **深入请求** - 支持自定义请求头、Cookies、Referer等
- **智能重试** - 下载失败自动尝试备用方法
- **并发下载** - 支持多线程并发下载

## 📦 安装依赖

```bash
pip install -r requirements.txt
```

## 🚀 快速开始

### 方式1：GUI界面（推荐）

```bash
python gui.py
```

如果GUI启动失败，会自动启动Web界面。

### 方式2：Web界面

```bash
python api_server.py
```

然后在浏览器中访问：http://localhost:5000

### 方式3：命令行

```bash
python main.py --url "视频页面URL" --output downloads
```

## 📖 使用说明

### GUI界面使用

1. **输入URL** - 在URL输入框中输入视频页面地址
2. **配置选项** - 设置保存目录、最大下载数、并发线程等
3. **高级选项** - 可选择强制抓包、断点续传、自动合并等
4. **开始下载** - 点击"开始下载"按钮

### Web界面使用

1. **资源检测**
   - 输入网页URL
   - 点击"开始检测"
   - 查看检测到的各类资源

2. **分类下载**
   - 点击资源卡片查看详情
   - 可选择：
     - 全选/取消全选
     - 下载选中的资源
     - 下载全部资源
     - 下载单个资源

3. **任务管理**
   - 查看所有下载任务
   - 暂停/继续/取消任务
   - 查看下载进度

## 🔧 配置说明

配置文件：`config.ini`

```ini
[download]
output_dir = downloads
max_downloads = 10
workers = 3
resume = true

[capture]
headless = true
wait_time = 10

[proxy]
enabled = false
http_proxy = 
https_proxy = 
```

## 📁 项目结构

```
video_slider/
├── gui.py                      # GUI主程序
├── api_server.py              # Web API服务器
├── main.py                    # 命令行主程序
├── config.ini                 # 配置文件
├── requirements.txt           # 依赖列表
├── utils/                     # 工具模块
│   ├── __init__.py
│   ├── logger.py             # 日志模块
│   ├── parser.py             # HTML解析器
│   ├── downloader.py         # 视频下载器
│   ├── enhanced_downloader.py # 增强下载器
│   ├── capture.py            # 网络抓包
│   ├── detector.py           # 智能检测
│   ├── resource_detector.py  # 资源检测器
│   ├── resource_downloader.py # 资源下载器
│   ├── task_manager.py       # 任务管理器
│   ├── database.py           # 数据库管理
│   └── ...
├── web/                       # Web界面
│   └── index.html            # 主页面
└── logs/                      # 日志目录
```

## 🎨 Web界面主题

Web界面采用青绿色（#1DB9AA）和白色为主题色，界面清新美观。

主要颜色：
- 主色调：`#1DB9AA` (青绿色)
- 渐变色：`#20E2D7` → `#1DB9AA`
- 背景色：白色
- 文字色：深灰色

## 🔥 增强下载功能

### 支持的下载方式

1. **直接下载** - 适用于小文件
2. **流式下载** - 适用于中等文件，支持进度显示
3. **分段下载** - 适用于大文件，支持断点续传
4. **M3U8下载** - 支持HLS流媒体下载
5. **Selenium下载** - 支持需要JavaScript渲染的页面

### 智能下载策略

- 自动检测文件类型和大小
- 根据服务器支持情况选择最佳方法
- 下载失败自动尝试备用方法
- 支持自定义请求头和Cookies

## 📊 支持的资源类型

- **视频** - mp4, avi, mov, wmv, flv, mkv, webm, m3u8
- **图片** - jpg, png, gif, bmp, webp, svg
- **音频** - mp3, wav, flac, aac, ogg, m4a
- **文档** - pdf, doc, docx, xls, xlsx, ppt, pptx
- **其他** - 样式表、脚本、字体等

## 🛡️ 错误处理

### GUI启动失败处理

当GUI界面启动失败时：
1. 显示错误信息
2. 自动启动Web服务器
3. 自动打开浏览器访问Web界面
4. 用户可继续使用Web界面完成任务

### 下载失败处理

当下载失败时：
1. 自动重试（最多3次）
2. 尝试备用下载方法
3. 记录错误日志
4. 提供重试选项

## 🔍 常见问题

### Q: GUI启动失败怎么办？
A: 程序会自动启动Web界面，或手动运行 `python api_server.py`

### Q: 下载速度慢怎么办？
A: 可以增加并发线程数，或使用代理

### Q: 某些视频无法下载？
A: 尝试使用强制抓包模式，或检查是否需要登录

### Q: 如何下载加密视频？
A: 启用"自动解密视频"选项

## 📝 更新日志

### v4.0 优化版 (2026-02-21)

**新增功能**
- ✅ 增强下载器，支持多种下载方式
- ✅ Web界面青绿色主题
- ✅ 分类下载功能（全部/单类/单个）
- ✅ GUI错误自动跳转Web
- ✅ 智能下载策略选择

**优化改进**
- 🔧 优化错误处理机制
- 🔧 改进资源检测算法
- 🔧 增强下载容错能力
- 🔧 优化界面交互体验

**修复问题**
- 🐛 修复GUI导入错误
- 🐛 修复下载失败不重试的问题
- 🐛 修复资源检测遗漏

## 📄 许可证

MIT License

## 👥 贡献

欢迎提交Issue和Pull Request！

## 📧 联系方式

如有问题或建议，请提交Issue。

---

**注意事项**
- 请遵守网站的robots.txt规则
- 不要用于非法用途
- 尊重版权，仅供学习研究使用
